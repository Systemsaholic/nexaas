services:
  engine:
    build: ./engine
    ports:
      - "8400:8400"
    env_file: .env
    environment:
      - HOST=0.0.0.0
      - PORT=8400
      - WORKSPACE_ROOT=/workspace
      - DATABASE_PATH=/app/data/nexaas.db
      - CORS_ORIGINS=*
    volumes:
      - ./workspace:/workspace
      - engine-data:/app/data
      - ~/.claude:/root/.claude

  dashboard:
    build: ./dashboard
    ports:
      - "3001:3000"
    environment:
      - NEXT_PUBLIC_DEFAULT_GATEWAY_URL=http://localhost:8400
      - ENGINE_INTERNAL_URL=http://engine:8400
      - DEFAULT_GATEWAY_KEY=${API_KEY:-dev-test-key}
    depends_on:
      - engine

volumes:
  engine-data:
